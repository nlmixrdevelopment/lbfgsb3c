<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>lbfgsb3c: Using the 2011 version of L-BFGS-B. • lbfgsb3c</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="lbfgsb3c: Using the 2011 version of L-BFGS-B.">
<meta property="og:description" content="lbfgsb3c">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lbfgsb3c</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2020-3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/lbfgsb3c.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="lbfgsb3c_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>lbfgsb3c: Using the 2011 version of L-BFGS-B.</h1>
                        <h4 class="author">John C Nash Telfer School of Management, University of Ottawa, <a href="mailto:nashjc@uottawa.ca" class="email">nashjc@uottawa.ca</a>
</h4>
            
            <h4 class="date">October 22, 2019</h4>
      
      
      <div class="hidden name"><code>lbfgsb3c.Rmd</code></div>

    </div>

    
    
<div id="abstract" class="section level1">
<h1 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h1>
<p>In 2011 the authors of the L-BFGSB program published a correction and update to their 1995 code. The latter is the basis of the L-BFGS-B method of the <code><a href="https://rdrr.io/r/stats/optim.html">optim()</a></code> function in base-R. The package <code>lbfgsb3</code> wrapped the updated code using a <code>.Fortran</code> call after removing a very large number of Fortran output statements. Matthew Fidler used this Fortran code and an <code>Rcpp</code> interface to produce package <code>lbfgsb3c</code> where the function <code><a href="../reference/lbfgsb3c.html">lbfgsb3c()</a></code> returns an object similar to that of base-R <code><a href="https://rdrr.io/r/stats/optim.html">optim()</a></code> and that of <code><a href="https://rdrr.io/pkg/optimx/man/optimr.html">optimx::optimr()</a></code>. Subsequently, in a fine example of the collaborations that have made <strong>R</strong> so useful, we have merged the functionality of package <code>lbfgsb3</code> into <code>lbfgsb3c</code>, as explained in this vignette. Note that this document is intended primarily to document our efforts to check the differences in variants of the code rather than be expository.</p>
<div id="provenance-of-the-r-optiml-bfgs-b-and-related-solvers" class="section level2">
<h2 class="hasAnchor">
<a href="#provenance-of-the-r-optiml-bfgs-b-and-related-solvers" class="anchor"></a>Provenance of the R optim::L-BFGS-B and related solvers</h2>
<p>The base-R code lbfgsb.c (at writing in R-3.5.2/src/appl/) is commented:</p>
<pre><code>/* l-bfgs-b.f -- translated by f2c (version 19991025).

  From ?optim:
  The code for method ‘"L-BFGS-B"’ is based on Fortran code by Zhu,
  Byrd, Lu-Chen and Nocedal obtained from Netlib (file 'opt/lbfgs_bcm.shar')

  The Fortran files contained no copyright information.

  Byrd, R. H., Lu, P., Nocedal, J. and Zhu, C.  (1995) A limited
  memory algorithm for bound constrained optimization.
  \emph{SIAM J. Scientific Computing}, \bold{16}, 1190--1208.
*/</code></pre>
<p>The paper <span class="citation">R. H. Byrd, Lu, Nocedal, and Zhu (1995a)</span> builds on <span class="citation">Lu et al. (1994)</span>. There have been a number of other workers who have followed-up on this work, but <strong>R</strong> code and packages seem to have largely stayed with codes derived from these original papers. Though the date of the paper is 1995, the ideas it embodies were around for a decade and a half at least, in particular in Nocedal80 and LiuN89. The definitive Fortran code was published as <span class="citation">Zhu et al. (1997)</span>. This is available as <code>toms/778.zip</code> on www.netlib.org. A side-by-side comparison of the main subroutines in the two downloads from Netlib unfortunately shows a lot of differences. I have not tried to determine if these affect performance or are simply cosmetic.</p>
<p>More seriously perhaps, there were some deficiencies in the code(s), and in 2011 Nocedal’s team published a Fortran code with some corrections (<span class="citation">Morales and Nocedal (2011)</span>). Since the <strong>R</strong> code predates this, I prepared package <code>lbfgsb3</code> (<span class="citation">Nash et al. (2015)</span>) to wrap the Fortran code. However, I did not discover any test cases where the <code>optim::L-BFGS-B</code> and <code>lbfgsb3</code> were different, though I confess to only running some limited tests. There are, in fact, more in this vignette.</p>
<p>In 2016, I was at a Fields Institute optimization conference in Toronto for the 70th birthday of Andy Conn. By sheer serendipity, Nocedal did not attend the conference, but sat down next to me at the conference dinner. When I asked him about the key changes, he said that the most important one was to fix the computation of the machine precision, which was not always correct in the 1995 code. Since <strong>R</strong> gets this number as <code>.Machine$double.eps</code>, the offending code is irrelevant.</p>
<p>Within <span class="citation">Morales and Nocedal (2011)</span>, there is also reported an improvement in the subspace minimization that is applied in cases of bounds constraints. Since few of the tests I have applied impose such constraints, it is reasonable that I will not have observed performance differences between the base-R <code>optim</code> code and my <code>lbfsgb3</code> package. More appropriate tests are welcome, and on my agenda.</p>
<p>Besides the ACM TOMS code, there are two related codes from the Northwestern team on NETLIB: <a href="http://netlib.org/opt/lbfgs_um.shar" class="uri">http://netlib.org/opt/lbfgs_um.shar</a> is for unconstrained minimization, while <a href="http://netlib.org/opt/lbfgs_bcm.shar" class="uri">http://netlib.org/opt/lbfgs_bcm.shar</a> handles bounds constrained problems. To these are attached references <span class="citation">Liu and Nocedal (1989)</span> and <span class="citation">R. H. Byrd, Lu, Nocedal, and Zhu (1995b)</span> respectively, most likely reflecting the effort required to implement the constraints.</p>
<p>The unconstrained code has been converted to <strong>C</strong> under the leadership of Naoaki Okazaki (see <a href="http://www.chokkan.org/software/liblbfgs/" class="uri">http://www.chokkan.org/software/liblbfgs/</a>, or the fork at <a href="https://github.com/MIRTK/LBFGS" class="uri">https://github.com/MIRTK/LBFGS</a>). This has been wrapped for <strong>R</strong> as <span class="citation">Coppola, Stewart, and Okazaki (2014)</span> as the <code>lbfgs</code> package. This can be called from <code><a href="https://rdrr.io/pkg/optimx/man/optimr.html">optimx::optimr()</a></code>.</p>
<p>Using Rcpp (see <span class="citation">Eddelbuettel and François (2011)</span>) and the Fortran code in package <code>lbfgs3</code>, Matthew Fidler developed package <code>lbfgsb3c</code> (<span class="citation">Fidler et al. (2018)</span>). As this provides a more standard call and return than <code>lbfgsb3</code> Fidler and I are unified the two packages and released them both under the same name <code>lbfgsb3c</code>.</p>
</div>
<div id="functions-in-package-lbfgsb3c" class="section level2">
<h2 class="hasAnchor">
<a href="#functions-in-package-lbfgsb3c" class="anchor"></a>Functions in package <code>lbfgsb3c</code>
</h2>
<p>There is really only one optimizer function in the package, but it may be called by four (4) names:</p>
<ul>
<li>
<code><a href="../reference/lbfgsb3c.html">lbfgsb3c()</a></code> uses Rcpp (<span class="citation">Eddelbuettel (2013)</span>, <span class="citation">Eddelbuettel and François (2011)</span>, <span class="citation">Eddelbuettel and Balamuta (2017)</span>) to streamline the call to the underlying Fortran. This is the base function used.</li>
<li>
<code><a href="../reference/lbfgsb3c.html">lbfgsb3x()</a></code> is an alias of <code><a href="../reference/lbfgsb3c.html">lbfgsb3c()</a></code>. We were using this name for a while, and have kept the alias to avoid having to edit test scripts.</li>
<li>
<code>lbfgsb3</code>, which imitates a <code>.Fortran</code> call of the compiled 2011 Fortran code. The object returned by this routine is NOT equivalent to the object returned by base-R <code><a href="https://rdrr.io/r/stats/optim.html">optim()</a></code> or by <code><a href="https://rdrr.io/pkg/optimx/man/optimr.html">optimx::optimr()</a></code>. Instead, it includes a structure <code>info</code> which contains the detailed diagnostic information of the Fortran code. For most users, this is not of interest, and I only recommend use of this function for those needing to examine how the optimization has been carried out.</li>
<li>
<code><a href="../reference/lbfgsb3c.html">lbfgsb3f()</a></code> is an alias of <code>lbfsgb3()</code>.</li>
</ul>
<p>We recommend using the <code>lbfsgb3c()</code> call for most uses.</p>
<div id="candlestick-function" class="section level3">
<h3 class="hasAnchor">
<a href="#candlestick-function" class="anchor"></a>Candlestick function</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># candlestick function</span>
<span class="co"># J C Nash 2011-2-3</span>
<span class="va">cstick.f</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">alpha</span><span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="va">r2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="va">f</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">r2</span><span class="op">+</span><span class="va">alpha</span><span class="op">/</span><span class="va">r2</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">cstick.g</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">alpha</span><span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="va">r2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html">crossprod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="va">g1</span><span class="op">&lt;-</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span>
  <span class="va">g2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">-</span><span class="va">alpha</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span><span class="op">/</span><span class="op">(</span><span class="va">r2</span><span class="op">*</span><span class="va">r2</span><span class="op">)</span>
  <span class="va">g</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">g1</span><span class="op">+</span><span class="va">g2</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>
<span class="op">}</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lbfgsb3c</span><span class="op">)</span>
<span class="va">nn</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>
<span class="va">lo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">up</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 10 10</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## c2o &lt;- opm(x0, cstick.f, cstick.g, lower=lo, upper=up, method=meths, control=list(trace=0))</span>
<span class="co">## print(summary(c2o, order=value))</span>
<span class="va">c2l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbfgsb3c.html">lbfgsb3c</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">cstick.f</span>, <span class="va">cstick.g</span>, lower<span class="op">=</span><span class="va">lo</span>, upper<span class="op">=</span><span class="va">up</span><span class="op">)</span>
<span class="va">c2l1</span></code></pre></div>
<pre><code>## $par
## [1] 2.236068 2.236068
## 
## $grad
## [1] -1.205926e-08 -1.205926e-08
## 
## $value
## [1] 20
## 
## $counts
## [1] 15 15
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH"</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## meths &lt;- c("L-BFGS-B", "lbfgsb3c", "Rvmmin", "Rcgmin", "Rtnmin")</span>
<span class="co">## require(optimx)</span>

<span class="co">## cstick2a &lt;- opm(x0, cstick.f, cstick.g, method=meths, upper=up, lower=lo, control=list(kkt=FALSE))</span>
<span class="co">## print(summary(cstick2a, par.select=1:2, order=value))</span>
<span class="va">lo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span>
<span class="co">## c2ob &lt;- opm(x0, cstick.f, cstick.g, lower=lo, upper=up, method=meths, control=list(trace=0))</span>
<span class="co">## print(summary(c2ob, order=value))</span>
<span class="va">c2l2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbfgsb3c.html">lbfgsb3c</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">cstick.f</span>, <span class="va">cstick.g</span>, lower<span class="op">=</span><span class="va">lo</span>, upper<span class="op">=</span><span class="va">up</span><span class="op">)</span>
<span class="va">c2l2</span></code></pre></div>
<pre><code>## $par
## [1] 4 4
## 
## $grad
## [1] 7.21875 7.21875
## 
## $value
## [1] 35.125
## 
## $counts
## [1] 4 4
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: NORM_OF_PROJECTED_GRADIENT_&lt;=_PGTOL"</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## cstick2b &lt;- opm(x0, cstick.f, cstick.g, method=meths, upper=up, lower=lo, control=list(kkt=FALSE))</span>
<span class="co">## print(summary(cstick2b, par.select=1:2, order=value))</span>

<span class="co">## nn &lt;- 100</span>
<span class="co">## x0 &lt;- rep(10, nn)</span>
<span class="co">## up &lt;- rep(10, nn)</span>
<span class="co">## lo &lt;- rep(1e-4, nn)</span>
<span class="co">## cco &lt;- opm(x0, cstick.f, cstick.g, lower=lo, upper=up, method=meths, control=list(trace=0, kkt=FALSE))</span>
<span class="co">## print(summary(cco, par.select=1:4, order=value))</span></code></pre></div>
</div>
<div id="extended-rosenbrock-function-from-funconstrain" class="section level3">
<h3 class="hasAnchor">
<a href="#extended-rosenbrock-function-from-funconstrain" class="anchor"></a>Extended Rosenbrock function (from funconstrain)</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># require(funconstrain) ## not in CRAN, so explicit inclusion of this function</span>
<span class="co"># exrosen &lt;- ex_rosen()</span>
<span class="co"># exrosenf &lt;- exrosen$fn</span>
<span class="va">exrosenf</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">par</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">n</span><span class="op">%%</span><span class="fl">2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Extended Rosenbrock: n must be even"</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="va">fsum</span> <span class="op">&lt;-</span> <span class="fl">0</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">p2</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">i</span>
        <span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op">-</span> <span class="fl">1</span>
        <span class="va">f_p1</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="op">*</span> <span class="op">(</span><span class="va">par</span><span class="op">[</span><span class="va">p2</span><span class="op">]</span> <span class="op">-</span> <span class="va">par</span><span class="op">[</span><span class="va">p1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
        <span class="va">f_p2</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">par</span><span class="op">[</span><span class="va">p1</span><span class="op">]</span>
        <span class="va">fsum</span> <span class="op">&lt;-</span> <span class="va">fsum</span> <span class="op">+</span> <span class="va">f_p1</span> <span class="op">*</span> <span class="va">f_p1</span> <span class="op">+</span> <span class="va">f_p2</span> <span class="op">*</span> <span class="va">f_p2</span>
    <span class="op">}</span>
    <span class="va">fsum</span>
<span class="op">}</span>
<span class="co"># exroseng &lt;- exrosen$gr</span>
<span class="va">exroseng</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">par</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">n</span><span class="op">%%</span><span class="fl">2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Extended Rosenbrock: n must be even"</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="va">grad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">p2</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">i</span>
        <span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op">-</span> <span class="fl">1</span>
        <span class="va">xx</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="va">p1</span><span class="op">]</span> <span class="op">*</span> <span class="va">par</span><span class="op">[</span><span class="va">p1</span><span class="op">]</span>
        <span class="va">yx</span> <span class="op">&lt;-</span> <span class="va">par</span><span class="op">[</span><span class="va">p2</span><span class="op">]</span> <span class="op">-</span> <span class="va">xx</span>
        <span class="va">f_p1</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="op">*</span> <span class="va">yx</span>
        <span class="va">f_p2</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">par</span><span class="op">[</span><span class="va">p1</span><span class="op">]</span>
        <span class="va">grad</span><span class="op">[</span><span class="va">p1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">grad</span><span class="op">[</span><span class="va">p1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">400</span> <span class="op">*</span> <span class="va">par</span><span class="op">[</span><span class="va">p1</span><span class="op">]</span> <span class="op">*</span> <span class="va">yx</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">f_p2</span>
        <span class="va">grad</span><span class="op">[</span><span class="va">p2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">grad</span><span class="op">[</span><span class="va">p2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">200</span> <span class="op">*</span> <span class="va">yx</span>
    <span class="op">}</span>
    <span class="va">grad</span>
<span class="op">}</span>

<span class="va">exrosenx0</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">n</span><span class="op">%%</span><span class="fl">2</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
        <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Extended Rosenbrock: n must be even"</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>
<span class="op">}</span>


<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">lbfgsb3c</span><span class="op">)</span>
<span class="co">## require(optimx)</span>

<span class="co">## require(optimx)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">12</span>, by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"ex_rosen try for n="</span>,<span class="va">n</span>,<span class="st">"\n"</span><span class="op">)</span>
  <span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu">exrosenx0</span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
  <span class="va">lo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>, <span class="va">n</span><span class="op">)</span>
  <span class="va">up</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="va">n</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"optim L-BFGS-B\n"</span><span class="op">)</span>
  <span class="va">eo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">exrosenf</span>, <span class="va">exroseng</span>, lower<span class="op">=</span><span class="va">lo</span>, upper<span class="op">=</span><span class="va">up</span>, method<span class="op">=</span><span class="st">"L-BFGS-B"</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">eo</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"lbfgsb3c\n"</span><span class="op">)</span>
  <span class="va">el</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbfgsb3c.html">lbfgsb3c</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">exrosenf</span>, <span class="va">exroseng</span>, lower<span class="op">=</span><span class="va">lo</span>, upper<span class="op">=</span><span class="va">up</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">el</span><span class="op">)</span>
<span class="co">##    erfg &lt;- opm(x0, exrosenf, exroseng, method=meths, lower=lo, upper=up)</span>
<span class="co">##    print(summary(erfg, par.select=1:2, order=value))</span>
<span class="op">}</span></code></pre></div>
<pre><code>## ex_rosen try for n= 2 
## [1] -1.2  1.0
## optim L-BFGS-B
## $par
## [1] 1 1
## 
## $value
## [1] 3.844416e-14
## 
## $counts
## function gradient 
##       51       51 
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH"
## 
## lbfgsb3c
## $par
## [1] 1.000000 1.000001
## 
## $grad
## [1]  8.331804e-06 -3.715433e-06
## 
## $value
## [1] 2.374318e-13
## 
## $counts
## [1] 61 61
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH"
## 
## ex_rosen try for n= 4 
## [1] -1.2  1.0 -1.2  1.0
## optim L-BFGS-B
## $par
## [1] 1 1 1 1
## 
## $value
## [1] 7.688835e-14
## 
## $counts
## function gradient 
##       51       51 
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH"
## 
## lbfgsb3c
## $par
## [1] 0.9999942 0.9999884 0.9999942 0.9999884
## 
## $grad
## [1]  4.530933e-06 -8.036816e-06  4.530933e-06 -8.036816e-06
## 
## $value
## [1] 6.693882e-11
## 
## $counts
## [1] 75 75
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH"
## 
## ex_rosen try for n= 6 
## [1] -1.2  1.0 -1.2  1.0 -1.2  1.0
## optim L-BFGS-B
## $par
## [1] 1 1 1 1 1 1
## 
## $value
## [1] 1.153325e-13
## 
## $counts
## function gradient 
##       51       51 
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH"
## 
## lbfgsb3c
## $par
## [1] 0.9999986 0.9999973 0.9999986 0.9999973 0.9999986 0.9999973
## 
## $grad
## [1] -7.930726e-05  3.822476e-05 -7.930726e-05  3.822476e-05 -7.930726e-05
## [6]  3.822476e-05
## 
## $value
## [1] 1.708394e-11
## 
## $counts
## [1] 74 74
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH"
## 
## ex_rosen try for n= 8 
## [1] -1.2  1.0 -1.2  1.0 -1.2  1.0 -1.2  1.0
## optim L-BFGS-B
## $par
## [1] 1 1 1 1 1 1 1 1
## 
## $value
## [1] 1.537767e-13
## 
## $counts
## function gradient 
##       51       51 
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH"
## 
## lbfgsb3c
## $par
## [1] 1.0000000 0.9999999 1.0000000 0.9999999 1.0000000 0.9999999 1.0000000
## [8] 0.9999999
## 
## $grad
## [1]  1.878639e-07 -1.259256e-07  1.878639e-07 -1.259256e-07  1.878639e-07
## [6] -1.259256e-07  1.878639e-07 -1.259256e-07
## 
## $value
## [1] 4.252944e-15
## 
## $counts
## [1] 62 62
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH"
## 
## ex_rosen try for n= 10 
##  [1] -1.2  1.0 -1.2  1.0 -1.2  1.0 -1.2  1.0 -1.2  1.0
## optim L-BFGS-B
## $par
##  [1] 1 1 1 1 1 1 1 1 1 1
## 
## $value
## [1] 1.922208e-13
## 
## $counts
## function gradient 
##       51       51 
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH"
## 
## lbfgsb3c
## $par
##  [1] 0.9999960 0.9999918 0.9999960 0.9999918 0.9999960 0.9999918 0.9999960
##  [8] 0.9999918 0.9999960 0.9999918
## 
## $grad
##  [1]  2.568217e-05 -1.687783e-05  2.568217e-05 -1.687783e-05  2.568217e-05
##  [6] -1.687783e-05  2.568217e-05 -1.687783e-05  2.568217e-05 -1.687783e-05
## 
## $value
## [1] 8.503449e-11
## 
## $counts
## [1] 70 70
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH"
## 
## ex_rosen try for n= 12 
##  [1] -1.2  1.0 -1.2  1.0 -1.2  1.0 -1.2  1.0 -1.2  1.0 -1.2  1.0
## optim L-BFGS-B
## $par
##  [1] 1 1 1 1 1 1 1 1 1 1 1 1
## 
## $value
## [1] 2.306652e-13
## 
## $counts
## function gradient 
##       51       51 
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH"
## 
## lbfgsb3c
## $par
##  [1] 0.9999672 0.9999341 0.9999672 0.9999341 0.9999672 0.9999341 0.9999672
##  [8] 0.9999341 0.9999672 0.9999341 0.9999672 0.9999341
## 
## $grad
##  [1]  1.161452e-05 -3.865353e-05  1.161452e-05 -3.865353e-05  1.161452e-05
##  [6] -3.865353e-05  1.161452e-05 -3.865353e-05  1.161452e-05 -3.865353e-05
## [11]  1.161452e-05 -3.865353e-05
## 
## $value
## [1] 6.495175e-09
## 
## $counts
## [1] 66 66
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH"</code></pre>
</div>
</div>
<div id="using-compiled-function-code" class="section level2">
<h2 class="hasAnchor">
<a href="#using-compiled-function-code" class="anchor"></a>Using compiled function code</h2>
<p>While you may use the same interface as described in the writing R extensions to interface compiled code with this function, see <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Optimization">L-BFGS-B</a>, it is sometimes more convenient to use your own compiled code.</p>
<p>The following example shows how this is done using the file <code>jrosen.f</code>. We have unfortunately found that compilation is not always portable across systems, so this example is presented without execution.</p>
<pre><code>       subroutine rosen(n, x, fval)
       double precision x(n), fval, dx
       integer n, i
       fval = 0.0D0
       do 10 i=1,(n-1)
          dx = x(i + 1) - x(i) * x(i)
          fval = fval + 100.0 * dx * dx
          dx = 1.0 - x(i)
          fval = fval + dx * dx
 10    continue
       return
       end</code></pre>
<p>Here is the example script. Note that we must have the file <code>jrosen.f</code> available. Because the executable files on different systems use different conventions and structures, we have turned evaluation off here so this vignette can be built on multiple platforms. However, we wished to provide examples of how compiled code could be used.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/system.html">system</a></span><span class="op">(</span><span class="st">"R CMD SHLIB jrosen.f"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dynload.html">dyn.load</a></span><span class="op">(</span><span class="st">"jrosen.so"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dynload.html">is.loaded</a></span><span class="op">(</span><span class="st">"rosen"</span><span class="op">)</span>
<span class="va">x0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">fv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="op">-</span><span class="fl">999</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">testf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Foreign.html">.Fortran</a></span><span class="op">(</span><span class="st">"rosen"</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">x0</span><span class="op">)</span>, fval<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">fv</span><span class="op">)</span><span class="op">)</span>
<span class="va">testf</span>

<span class="va">rrosen</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">fval</span> <span class="op">&lt;-</span> <span class="fl">0.0</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">dx</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">fval</span> <span class="op">&lt;-</span> <span class="va">fval</span> <span class="op">+</span> <span class="fl">100.0</span> <span class="op">*</span> <span class="va">dx</span> <span class="op">*</span> <span class="va">dx</span>
    <span class="va">dx</span> <span class="op">&lt;-</span> <span class="fl">1.0</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">fval</span> <span class="op">&lt;-</span> <span class="va">fval</span> <span class="op">+</span> <span class="va">dx</span> <span class="op">*</span> <span class="va">dx</span>
  <span class="op">}</span>
  <span class="va">fval</span>
<span class="op">}</span>

<span class="op">(</span><span class="fu">rrosen</span><span class="op">(</span><span class="va">x0</span><span class="op">)</span><span class="op">)</span>

<span class="va">frosen</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">nn</span> <span class="op">&gt;</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"max number of parameters is 100"</span><span class="op">)</span><span class="op">}</span>
  <span class="va">fv</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">999.0</span>
  <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Foreign.html">.Fortran</a></span><span class="op">(</span><span class="st">"rosen"</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">nn</span><span class="op">)</span>, x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, fval<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">fv</span><span class="op">)</span><span class="op">)</span>
  <span class="va">val</span><span class="op">$</span><span class="va">fval</span> <span class="co"># NOTE--need ONLY function value returned</span>
<span class="op">}</span>
<span class="co"># Test the funcion</span>
<span class="va">tval</span> <span class="op">&lt;-</span> <span class="fu">frosen</span><span class="op">(</span><span class="va">x0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">tval</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Run with Nelder-Mead using R function\n"</span><span class="op">)</span>
<span class="va">mynm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">rrosen</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">mynm</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n\n Run with Nelder-Mead using Fortran function"</span><span class="op">)</span>
<span class="va">mynmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">frosen</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">mynmf</span><span class="op">)</span>


<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lbfgsb3c</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/">microbenchmark</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"try lbfgsb3c, no Gradient \n"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"R function\n"</span><span class="op">)</span>
<span class="va">tlR</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span><span class="va">myopR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbfgsb3c.html">lbfgsb3c</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">rrosen</span>, gr<span class="op">=</span><span class="cn">NULL</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tlR</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">myopR</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Fortran function\n"</span><span class="op">)</span>
<span class="va">tlF</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span><span class="va">myop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbfgsb3c.html">lbfgsb3c</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">frosen</span>, gr<span class="op">=</span><span class="cn">NULL</span>, control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tlF</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">myop</span><span class="op">)</span></code></pre></div>
<p>In this example, Fortran execution was actually SLOWER than plain R on the system where it was run.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Byrd95">
<p>Byrd, Richard H., Peihuang Lu, Jorge Nocedal, and Ci You Zhu. 1995a. “A Limited Memory Algorithm for Bound Constrained Optimization.” <em>SIAM Journal on Scientific Computing</em> 16 (5): 1190–1208.</p>
</div>
<div id="ref-Byrd1995">
<p>Byrd, Richard H., Peihuang Lu, Jorge Nocedal, and Ciyou Zhu. 1995b. “A Limited Memory Algorithm for Bound Constrained Optimization.” <em>SIAM J. Sci. Comput.</em> 16 (5): 1190–1208. <a href="https://doi.org/10.1137/0916069">https://doi.org/10.1137/0916069</a>.</p>
</div>
<div id="ref-Coppola2014">
<p>Coppola, Antonio, Brandon Stewart, and Naoaki Okazaki. 2014. <em>Lbfgs: Limited-Memory Bfgs Optimization</em>. <a href="https://CRAN.R-project.org/package=lbfgs">https://CRAN.R-project.org/package=lbfgs</a>.</p>
</div>
<div id="ref-RCppDE2013">
<p>Eddelbuettel, Dirk. 2013. <em>Seamless R and C++ Integration with Rcpp</em>. New York: Springer. <a href="https://doi.org/10.1007/978-1-4614-6868-4">https://doi.org/10.1007/978-1-4614-6868-4</a>.</p>
</div>
<div id="ref-RCppDEJJB2017">
<p>Eddelbuettel, Dirk, and James Joseph Balamuta. 2017. “Extending extitR with extitC++: A Brief Introduction to extitRcpp.” <em>PeerJ Preprints</em> 5 (August): e3188v1. <a href="https://doi.org/10.7287/peerj.preprints.3188v1">https://doi.org/10.7287/peerj.preprints.3188v1</a>.</p>
</div>
<div id="ref-RCppDERF2011">
<p>Eddelbuettel, Dirk, and Romain François. 2011. “Rcpp: Seamless R and C++ Integration.” <em>Journal of Statistical Software</em> 40 (8): 1–18. <a href="https://doi.org/10.18637/jss.v040.i08">https://doi.org/10.18637/jss.v040.i08</a>.</p>
</div>
<div id="ref-lbfgsb3cMF">
<p>Fidler, Matthew L, John C Nash, Ciyou Zhu, Richard Byrd, Jorge Nocedal, and Jose Luis Morales. 2018. <em>lbfgsb3c: Limited Memory Bfgs Minimizer with Bounds on Parameters with Optim() ’c’ Interface</em>. <a href="https://CRAN.R-project.org/package=lbfgsb3c">https://CRAN.R-project.org/package=lbfgsb3c</a>.</p>
</div>
<div id="ref-LiuN89">
<p>Liu, Dong C., and Jorge Nocedal. 1989. “On the Limited Memory BFGS Method for Large Scale Optimization.” <em>Math. Program.</em> 45 (1-3): 503–28. <a href="https://doi.org/10.1007/BF01589116">https://doi.org/10.1007/BF01589116</a>.</p>
</div>
<div id="ref-Lu94limitedmemory">
<p>Lu, Peihuang, Jorge Nocedal, Ciyou Zhu, and Richard H. Byrd. 1994. “A Limited-Memory Algorithm for Bound Constrained Optimization.” <em>SIAM Journal on Scientific Computing</em> 16: 1190–1208.</p>
</div>
<div id="ref-Morales2011">
<p>Morales, José Luis, and Jorge Nocedal. 2011. “Remark on Algorithm 778: L-BFGS-B: Fortran subroutines for large-scale bound constrained optimization.” <em>ACM Trans. Math. Softw.</em> 38 (1): 7:1–7:4. <a href="http://doi.acm.org/10.1145/2049662.2049669">http://doi.acm.org/10.1145/2049662.2049669</a>.</p>
</div>
<div id="ref-lbfgsb3JN">
<p>Nash, John C, Ciyou Zhu, Richard Byrd, Jorge Nocedal, and Jose Luis Morales. 2015. <em>lbfgsb3: Limited Memory Bfgs Minimizer with Bounds on Parameters</em>. <a href="https://CRAN.R-project.org/package=lbfgsb3">https://CRAN.R-project.org/package=lbfgsb3</a>.</p>
</div>
<div id="ref-Zhu1997LBFGS">
<p>Zhu, Ciyou, Richard H. Byrd, Peihuang Lu, and Jorge Nocedal. 1997. “Algorithm 778: L-BFGS-B: Fortran Subroutines for Large-Scale Bound-Constrained Optimization.” <em>ACM Trans. Math. Softw.</em> 23 (4): 550–60. <a href="https://doi.org/10.1145/279232.279236">https://doi.org/10.1145/279232.279236</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matthew L Fidler, John C Nash, Ciyou Zhu, Richard Byrd, Jorge Nocedal, Jose Luis Morales.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
